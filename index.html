
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>TreadPro Manager</title>
  
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <!-- Estilos Globales y Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & Babel (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      background-color: #0f172a;
      color: #f8fafc;
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: system-ui, -apple-system, sans-serif;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
      -webkit-appearance: none; 
      margin: 0; 
    }
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    .pt-safe { padding-top: env(safe-area-inset-top); }
    
    /* Animación suave para cambios de tramo */
    .timer-alert {
      animation: pulse-red 1s infinite;
    }
    @keyframes pulse-red {
      0% { background-color: rgba(127, 29, 29, 0.4); }
      50% { background-color: rgba(185, 28, 28, 0.6); }
      100% { background-color: rgba(127, 29, 29, 0.4); }
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
<body class="bg-slate-900">
  <div id="root">
    <div style="height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 20px;">
      <div style="width: 40px; height: 40px; border: 4px solid #10b981; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
      <p style="color: #94a3b8; font-family: sans-serif; font-weight: bold; letter-spacing: 1px;">CARGANDO TREADPRO...</p>
    </div>
  </div>

  <style> @keyframes spin { to { transform: rotate(360deg); } } </style>

  <script type="text/babel" data-presets="react">
    const { useState, useEffect, useRef, useMemo } = React;
    const { createRoot } = ReactDOM;

    // --- ICONOS SVG ---
    const IconActivity = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
    );
    const IconPlus = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    );
    const IconChevronRight = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="9 18 15 12 9 6"/></svg>
    );
    const IconFlame = ({ size = 12, className = "", fill = "none" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.332-.224-4.218 1.149-5.716C12.418 1.97 14.773 2.5 15.655 5c.783 2.22-1.298 3.504-1.155 5.5.093 1.3.652 2.373 1.134 2.879 1.137 1.192 2.366 1.127 2.366 1.127A8 8 0 1 1 9 5.539c0 .736.334 2.126.826 3.037.195.362.536.637.77.924a2.502 2.502 0 0 1 .581 1.776z"/></svg>
    );
    const IconZap = ({ size = 12, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
    );
    const IconPlay = ({ size = 24, fill = "none" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
    );
    const IconPause = ({ size = 24, fill = "none" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
    );
    const IconSkip = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 4 15 12 5 20 5 4"/><line x1="19" y1="5" x2="19" y2="19"/></svg>
    );
    const IconSquare = ({ size = 20, fill = "none" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>
    );
    const IconMountain = ({ size = 16, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m8 3 4 8 5-5 5 15H2L8 3z"/></svg>
    );
    const IconRuler = ({ size = 16, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
    );
    const IconTrash = ({ size = 16 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
    );
    const IconClock = ({ size = 16, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
    );

    // --- SERVICIOS ---
    const audioService = {
      context: null,
      init() {
        if (!this.context) {
          this.context = new (window.AudioContext || window.webkitAudioContext)();
        }
      },
      async resume() {
        this.init();
        if (this.context.state === 'suspended') await this.context.resume();
      },
      beep(freq, dur) {
        if (!this.context || this.context.state !== 'running') return;
        const osc = this.context.createOscillator();
        const gain = this.context.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(freq, this.context.currentTime);
        gain.gain.setValueAtTime(0.1, this.context.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + dur / 1000);
        osc.connect(gain);
        gain.connect(this.context.destination);
        osc.start();
        osc.stop(this.context.currentTime + dur / 1000);
      }
    };

    const calculateSessionStats = (segments) => {
      let totalCalories = 0;
      let intensitySum = 0;
      let totalDistance = 0; // en metros
      let totalElevation = 0; // en metros
      let totalDuration = 0; // en segundos

      segments.forEach(s => {
        totalDuration += s.duration;
        const speedMetersPerSec = (s.speed * 1000) / 3600;
        const speedMetersPerMin = (s.speed * 1000) / 60;
        
        // Distancia en este tramo
        const segmentDist = speedMetersPerSec * s.duration;
        totalDistance += segmentDist;
        
        // Desnivel en este tramo
        const segmentElev = segmentDist * (s.incline / 100);
        if (segmentElev > 0) totalElevation += segmentElev;

        // Calorías
        const mets = (0.1 * speedMetersPerMin + 1.8 * speedMetersPerMin * (s.incline / 100) + 3.5) / 3.5;
        totalCalories += mets * 75 * (s.duration / 3600);
        intensitySum += (s.speed * 0.6 + s.incline * 0.4) * (s.duration / 60);
      });

      const avg = intensitySum / (totalDuration / 60 || 1);
      
      const totalMins = Math.floor(totalDuration / 60);
      const totalSecs = totalDuration % 60;
      const formattedDuration = `${totalMins}m ${totalSecs > 0 ? totalSecs + 's' : ''}`.trim();

      return { 
        calories: Math.round(totalCalories), 
        fatBurnLevel: avg > 8 ? 5 : avg > 6 ? 4 : avg > 4 ? 3 : avg > 2 ? 2 : 1,
        distanceKm: (totalDistance / 1000).toFixed(2),
        elevationM: Math.round(totalElevation),
        durationSec: totalDuration,
        formattedDuration
      };
    };

    // --- COMPONENTES ---

    const TrainingProfile = ({ segments, currentIndex }) => {
      const maxSpeed = 15;
      const height = 40;
      const width = 100;
      const step = width / (segments.length || 1);

      return (
        <div className="h-20 bg-slate-800/30 rounded-xl overflow-hidden relative border border-slate-700/50 mt-4 mb-4">
          <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full" preserveAspectRatio="none">
            <path
              d={`M 0 ${height} ${segments.map((s, i) => `L ${i * step} ${height - (s.speed / maxSpeed) * height} L ${(i + 1) * step} ${height - (s.speed / maxSpeed) * height}`).join(' ')} L ${width} ${height} Z`}
              fill="rgba(59, 130, 246, 0.2)"
              stroke="#3b82f6"
              strokeWidth="0.5"
            />
            <path
              d={`M 0 ${height} ${segments.map((s, i) => `L ${i * step} ${height - (s.incline / maxSpeed) * height} L ${(i + 1) * step} ${height - (s.incline / maxSpeed) * height}`).join(' ')} L ${width} ${height} Z`}
              fill="rgba(249, 115, 22, 0.1)"
              stroke="#f97316"
              strokeWidth="0.5"
              strokeDasharray="1,1"
            />
            <rect x={currentIndex * step} y="0" width={step} height={height} fill="rgba(255,255,255,0.15)" className="animate-pulse" />
          </svg>
        </div>
      );
    };

    const TimerDisplay = ({ seconds, label, size = 'lg', color = 'text-white' }) => {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      const formatted = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      return (
        <div className="flex flex-col items-center">
          <span className="text-[10px] font-bold uppercase tracking-wider text-slate-500 mb-1">{label}</span>
          <span className={`${size === 'lg' ? 'text-6xl sm:text-7xl' : 'text-3xl'} font-black font-mono ${color}`}>
            {formatted}
          </span>
        </div>
      );
    };

    const NumericInput = ({ label, value, onChange, max, min = 0, step = "1" }) => (
      <div className="flex flex-col">
        <label className="text-[10px] uppercase text-slate-500 font-bold mb-1 text-center truncate">{label}</label>
        <input 
          type="number" step={step} value={value}
          onChange={(e) => {
            const val = parseFloat(e.target.value) || 0;
            let finalVal = val;
            if (max !== undefined) finalVal = Math.min(max, finalVal);
            if (min !== undefined) finalVal = Math.max(min, finalVal);
            onChange(finalVal);
          }}
          className="bg-slate-900 text-white p-2 rounded border border-slate-700 focus:border-emerald-500 outline-none w-full text-center font-mono font-bold"
        />
      </div>
    );

    const WorkoutRunner = ({ session, onFinish, onCancel }) => {
      const [idx, setIdx] = useState(0);
      const [timeLeft, setTimeLeft] = useState(session.segments[0].duration);
      const [totalElapsed, setTotalElapsed] = useState(0);
      const [isActive, setIsActive] = useState(true);
      
      const [distanceMeters, setDistanceMeters] = useState(0);
      const [elevationGain, setElevationGain] = useState(0);

      const totalDuration = useMemo(() => session.segments.reduce((a, s) => a + s.duration, 0), [session]);
      const isAlarming = timeLeft <= 5 && timeLeft > 0;

      useEffect(() => {
        let timer;
        if (isActive) {
          timer = setInterval(() => {
            const current = session.segments[idx];
            const speedMS = (current.speed * 1000) / 3600; 
            const deltaDist = speedMS * 1; 
            const deltaElev = deltaDist * (current.incline / 100);

            setDistanceMeters(prev => prev + deltaDist);
            if (deltaElev > 0) setElevationGain(prev => prev + deltaElev);

            setTimeLeft(prev => {
              if (prev <= 1) {
                if (idx < session.segments.length - 1) {
                  const nextIdx = idx + 1;
                  setIdx(nextIdx);
                  audioService.beep(1200, 500);
                  return session.segments[nextIdx].duration;
                } else {
                  setIsActive(false);
                  onFinish();
                  return 0;
                }
              }
              if (prev <= 6) audioService.beep(440, 150);
              return prev - 1;
            });
            setTotalElapsed(prev => prev + 1);
          }, 1000);
        }
        return () => clearInterval(timer);
      }, [isActive, idx, session]);

      const current = session.segments[idx];
      const next = session.segments[idx + 1];

      return (
        <div className={`fixed inset-0 z-50 transition-colors ${isAlarming ? 'timer-alert' : 'bg-slate-900'}`}>
          <div className="max-w-md mx-auto h-full flex flex-col p-6 overflow-y-auto pt-safe pb-safe">
            <header className="flex justify-between items-center mb-6">
              <div>
                <h2 className="text-xl font-black text-white">{session.name}</h2>
                <p className="text-xs font-bold text-slate-500 uppercase tracking-tighter">Tramo {idx + 1} de {session.segments.length}</p>
              </div>
              <button onClick={onCancel} className="p-3 bg-slate-800 rounded-full text-slate-400 active:scale-90"><IconSquare fill="currentColor" /></button>
            </header>

            <div className="mb-6 grid grid-cols-2 gap-4">
               <div className="flex flex-col items-center bg-slate-800/40 p-3 rounded-2xl border border-slate-700/50">
                  <span className="text-[9px] uppercase font-black text-slate-500 mb-1 flex items-center gap-1"><IconRuler size={10}/> Distancia</span>
                  <span className="text-2xl font-black font-mono text-emerald-400">{(distanceMeters/1000).toFixed(2)} <small className="text-xs font-normal">km</small></span>
               </div>
               <div className="flex flex-col items-center bg-slate-800/40 p-3 rounded-2xl border border-slate-700/50">
                  <span className="text-[9px] uppercase font-black text-slate-500 mb-1 flex items-center gap-1"><IconMountain size={10}/> Desnivel +</span>
                  <span className="text-2xl font-black font-mono text-orange-400">+{elevationGain.toFixed(1)} <small className="text-xs font-normal">m</small></span>
               </div>
            </div>

            <div className="mb-6 flex flex-col gap-6">
              <TimerDisplay seconds={Math.max(0, totalDuration - totalElapsed)} label="Restante Total" size="sm" color="text-emerald-400" />
              <div className={`p-8 rounded-3xl border-4 transition-all flex items-center justify-center ${isAlarming ? 'border-red-500 bg-red-500/10 scale-105' : 'border-slate-800 bg-slate-800/50'}`}>
                <TimerDisplay seconds={timeLeft} label="Siguiente cambio en..." />
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4 mb-4">
              <div className="bg-slate-800 p-4 rounded-2xl border border-slate-700 text-center relative overflow-hidden">
                <div className="absolute top-0 left-0 w-1 h-full bg-blue-500 opacity-50"></div>
                <span className="text-[10px] text-slate-500 uppercase font-black block mb-1">Velocidad</span>
                <span className="text-4xl font-black text-blue-400">{current.speed}<small className="text-xs ml-1 font-normal">km/h</small></span>
              </div>
              <div className="bg-slate-800 p-4 rounded-2xl border border-slate-700 text-center relative overflow-hidden">
                <div className="absolute top-0 left-0 w-1 h-full bg-orange-500 opacity-50"></div>
                <span className="text-[10px] text-slate-500 uppercase font-black block mb-1">Inclinación</span>
                <span className="text-4xl font-black text-orange-400">{current.incline}<small className="text-xs ml-1 font-normal">%</small></span>
              </div>
            </div>

            <TrainingProfile segments={session.segments} currentIndex={idx} />

            <div className="p-4 bg-slate-800/80 rounded-2xl border border-dashed border-slate-700 flex items-center justify-between mb-8">
               <div className="flex flex-col">
                  <span className="text-[9px] text-slate-500 font-black uppercase tracking-widest mb-1">Próximo Cambio</span>
                  <span className="text-sm font-bold text-slate-300">
                    {next ? `${next.speed} km/h • ${next.incline}% incl.` : "¡Enfriamiento final!"}
                  </span>
               </div>
               <IconChevronRight className="text-slate-600" size={16} />
            </div>

            <div className="mt-auto flex justify-center gap-10 pb-6">
              <button onClick={() => setIsActive(!isActive)} className={`w-20 h-20 rounded-full flex items-center justify-center transition-all ${isActive ? 'bg-slate-800 text-white' : 'bg-emerald-500 text-slate-900 shadow-xl shadow-emerald-500/20'}`}>
                {isActive ? <IconPause fill="currentColor" /> : <IconPlay fill="currentColor" />}
              </button>
              <button onClick={() => { if(idx < session.segments.length -1) { setIdx(idx + 1); setTimeLeft(session.segments[idx+1].duration); } else onFinish(); }} className="w-20 h-20 rounded-full bg-slate-800 text-slate-400 border border-slate-700 flex items-center justify-center">
                <IconSkip />
              </button>
            </div>
          </div>
        </div>
      );
    };

    const WorkoutSetup = ({ session, onStart, onBack }) => {
      const [edited, setEdited] = useState({...session, segments: [...session.segments]});
      const stats = calculateSessionStats(edited.segments);

      const updateSegment = (i, updates) => {
        const segs = [...edited.segments];
        segs[i] = { ...segs[i], ...updates };
        setEdited({...edited, segments: segs});
      };

      const addSegment = () => {
        const last = edited.segments[edited.segments.length - 1];
        const newSeg = { 
          id: Date.now().toString(), 
          duration: last?.duration || 300, 
          speed: last?.speed || 5, 
          incline: last?.incline || 0 
        };
        setEdited({...edited, segments: [...edited.segments, newSeg]});
      };

      const removeSegment = (i) => {
        if (edited.segments.length <= 1) return;
        const segs = edited.segments.filter((_, idx) => idx !== i);
        setEdited({...edited, segments: segs});
      };

      return (
        <div className="max-w-md mx-auto p-6 pb-32 pt-safe">
          <div className="flex items-center gap-4 mb-6">
            <button onClick={onBack} className="p-2 text-slate-400 hover:text-white"><IconChevronRight className="rotate-180" /></button>
            <h1 className="text-2xl font-black">Configurar</h1>
          </div>

          <div className="bg-slate-800 p-6 rounded-3xl mb-8 border border-slate-700 shadow-2xl">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-lg font-bold text-white">{edited.name}</h2>
              <span className="text-[10px] font-black bg-emerald-500/20 text-emerald-500 px-2 py-1 rounded uppercase tracking-tighter">{edited.segments.length} Tramos</span>
            </div>
            <div className="grid grid-cols-4 gap-2">
              <div className="bg-slate-900/50 p-2 rounded-xl text-center border border-slate-700/50">
                <span className="text-[8px] text-slate-500 uppercase font-black block mb-0.5">Tiempo</span>
                <span className="text-xs font-bold text-white">{stats.formattedDuration}</span>
              </div>
              <div className="bg-slate-900/50 p-2 rounded-xl text-center border border-slate-700/50">
                <span className="text-[8px] text-slate-500 uppercase font-black block mb-0.5">Calorías</span>
                <span className="text-xs font-bold text-orange-400">{stats.calories} <small className="text-[8px]">KCAL</small></span>
              </div>
              <div className="bg-slate-900/50 p-2 rounded-xl text-center border border-slate-700/50">
                <span className="text-[8px] text-slate-500 uppercase font-black block mb-0.5">Distancia</span>
                <span className="text-xs font-bold text-blue-400">{stats.distanceKm} <small className="text-[8px]">KM</small></span>
              </div>
              <div className="bg-slate-900/50 p-2 rounded-xl text-center border border-slate-700/50">
                <span className="text-[8px] text-slate-500 uppercase font-black block mb-0.5">Desnivel</span>
                <span className="text-xs font-bold text-emerald-400">+{stats.elevationM} <small className="text-[8px]">M</small></span>
              </div>
            </div>
          </div>

          <div className="space-y-4">
            {edited.segments.map((s, i) => (
              <div key={i} className="bg-slate-800/40 p-4 rounded-2xl border border-slate-800">
                <div className="flex justify-between mb-3">
                  <span className="text-[10px] font-black text-slate-600 uppercase">Tramo {i+1}</span>
                  <button onClick={() => removeSegment(i)} className="text-slate-600 active:text-red-500"><IconTrash size={14} /></button>
                </div>
                <div className="grid grid-cols-4 gap-2">
                  <NumericInput label="MIN" value={Math.floor(s.duration / 60)} onChange={m => updateSegment(i, { duration: (m * 60) + (s.duration % 60) })} />
                  <NumericInput label="SEG" value={s.duration % 60} max={59} onChange={sec => updateSegment(i, { duration: (Math.floor(s.duration / 60) * 60) + sec })} />
                  <NumericInput label="KM/H" step="0.1" value={s.speed} onChange={v => updateSegment(i, { speed: v })} max={15} />
                  <NumericInput label="% INC" value={s.incline} onChange={v => updateSegment(i, { incline: v })} max={15} />
                </div>
              </div>
            ))}
          </div>

          <button onClick={addSegment} className="mt-6 w-full py-4 border-2 border-dashed border-slate-700 rounded-2xl text-slate-500 font-bold flex items-center justify-center gap-2 active:bg-slate-800 transition-colors">
            <IconPlus size={20} /> Añadir Tramo
          </button>

          <div className="fixed bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-slate-900 via-slate-900 to-transparent">
            <button onClick={() => onStart(edited)} className="w-full max-w-md mx-auto bg-emerald-500 text-slate-900 py-5 rounded-2xl font-black text-xl shadow-xl active:scale-95 transition-all flex items-center justify-center gap-3">
              <IconPlay fill="currentColor" /> INICIAR
            </button>
          </div>
        </div>
      );
    };

    const App = () => {
      const [view, setView] = useState('HOME');
      const [session, setSession] = useState(null);

      const DEFAULT_SESSIONS = [
        { 
          id: 'hiit_gonzalo', 
          name: 'HIIT GONZALO', 
          description: 'Pirámide de intensidad con escalada progresiva y enfriamiento detallado.', 
          segments: [
            { id: '1', duration: 300, speed: 3.5, incline: 5 },
            { id: '2', duration: 360, speed: 4.5, incline: 8 },
            { id: '3', duration: 360, speed: 4.5, incline: 11 },
            { id: '4', duration: 360, speed: 4.5, incline: 9 },
            { id: '5', duration: 360, speed: 4.5, incline: 12 },
            { id: '6', duration: 60, speed: 4.5, incline: 13 },
            { id: '7', duration: 60, speed: 4.5, incline: 14 },
            { id: '8', duration: 60, speed: 4.5, incline: 15 },
            { id: '9', duration: 30, speed: 4, incline: 14 },
            { id: '10', duration: 30, speed: 4, incline: 13 },
            { id: '11', duration: 30, speed: 4, incline: 12 },
            { id: '12', duration: 30, speed: 4, incline: 11 },
            { id: '13', duration: 30, speed: 4, incline: 10 },
            { id: '14', duration: 30, speed: 4, incline: 9 },
            { id: '15', duration: 30, speed: 4, incline: 8 },
            { id: '16', duration: 30, speed: 4, incline: 7 },
            { id: '17', duration: 30, speed: 4, incline: 6 },
            { id: '18', duration: 30, speed: 3.5, incline: 5 },
            { id: '19', duration: 30, speed: 3.5, incline: 4 },
            { id: '20', duration: 30, speed: 3, incline: 3 },
            { id: '21', duration: 60, speed: 2, incline: 2 }
          ] 
        },
        { 
          id: 'super_trekking', 
          name: 'SUPER TREKKING', 
          description: 'Máxima quema calórica manteniendo paso firme y pendientes de montaña.', 
          segments: [
            { id: 'st1', duration: 300, speed: 4.0, incline: 6 },
            { id: 'st2', duration: 900, speed: 5.0, incline: 12 },
            { id: 'st3', duration: 600, speed: 4.8, incline: 15 },
            { id: 'st4', duration: 900, speed: 5.0, incline: 11 },
            { id: 'st5', duration: 300, speed: 4.0, incline: 5 }
          ] // 50 min
        },
        { 
          id: 'potencia_vertical', 
          name: 'POTENCIA VERTICAL', 
          description: 'Resistencia en pendiente pronunciada para superar las 450 Kcal sin correr.', 
          segments: [
            { id: 'pv1', duration: 300, speed: 4.5, incline: 8 },
            { id: 'pv2', duration: 1200, speed: 5.0, incline: 13 },
            { id: 'pv3', duration: 1200, speed: 5.0, incline: 14 },
            { id: 'pv4', duration: 600, speed: 4.5, incline: 9 },
            { id: 'pv5', duration: 180, speed: 3.0, incline: 3 }
          ] // 58 min
        },
        { 
          id: 'quema_grasa_pro', 
          name: 'QUEMA GRASA PRO', 
          description: 'Optimización de oxidación de grasas con alta inclinación y velocidad controlada.', 
          segments: [
            { id: 'qg1', duration: 300, speed: 4, incline: 5 },
            { id: 'qg2', duration: 600, speed: 5, incline: 10 },
            { id: 'qg3', duration: 600, speed: 5, incline: 12 },
            { id: 'qg4', duration: 600, speed: 5, incline: 11 },
            { id: 'qg5', duration: 300, speed: 3.5, incline: 4 }
          ]
        },
        { 
          id: 'montana_activa', 
          name: 'MONTAÑA ACTIVA', 
          description: 'Simulación de senderismo intenso con pendientes pronunciadas.', 
          segments: [
            { id: 'ma1', duration: 600, speed: 4.5, incline: 8 },
            { id: 'ma2', duration: 600, speed: 4.5, incline: 13 },
            { id: 'ma3', duration: 600, speed: 4.5, incline: 15 },
            { id: 'ma4', duration: 600, speed: 4.5, incline: 11 },
            { id: 'ma5', duration: 300, speed: 3, incline: 5 }
          ]
        },
        { 
          id: 'fat_burn_basic', 
          name: 'FAT BURN SOFT', 
          description: 'Intervalos moderados constantes para principiantes.', 
          segments: [
            { id: 'f1', duration: 600, speed: 4.5, incline: 2 }, 
            { id: 'f2', duration: 600, speed: 5, incline: 3 }, 
            { id: 'f3', duration: 600, speed: 4.5, incline: 1 }
          ] 
        }
      ];

      const start = () => audioService.resume().catch(console.error);

      return (
        <div className="min-h-screen pb-20 pt-safe" onClick={start}>
          {view === 'HOME' && (
            <div className="max-w-md mx-auto p-6">
              <header className="py-12">
                <h1 className="text-4xl font-black tracking-tighter flex items-center gap-2 text-white">
                  <IconActivity className="text-emerald-500" size={36} /> TreadPro
                </h1>
                <p className="text-slate-500 font-bold uppercase text-[10px] tracking-widest mt-1">Professional PWA Tracker</p>
              </header>

              <div className="grid gap-4">
                {DEFAULT_SESSIONS.map(s => {
                  const stats = calculateSessionStats(s.segments);
                  return (
                    <button key={s.id} onClick={() => { setSession(s); setView('SETUP'); start(); }} className="bg-slate-800 p-5 rounded-3xl border border-slate-700 text-left flex flex-col group active:scale-95 transition-all">
                      <div className="flex justify-between items-start mb-2">
                        <div className="flex-1 pr-4">
                          <h3 className="text-xl font-black group-active:text-emerald-400 text-white">{s.name}</h3>
                          <p className="text-xs text-slate-500 line-clamp-1">{s.description}</p>
                        </div>
                        <IconChevronRight className="text-slate-600 group-active:text-emerald-400" />
                      </div>
                      
                      <div className="grid grid-cols-2 gap-y-2 mt-2">
                         <div className="flex items-center gap-1.5">
                            <IconClock size={12} className="text-emerald-400" />
                            <span className="text-[10px] font-bold text-slate-300">{stats.formattedDuration}</span>
                         </div>
                         <div className="flex items-center gap-1.5">
                            <IconRuler size={12} className="text-blue-500" />
                            <span className="text-[10px] font-bold text-slate-300">{stats.distanceKm} km</span>
                         </div>
                         <div className="flex items-center gap-1.5">
                            <IconMountain size={12} className="text-emerald-500" />
                            <span className="text-[10px] font-bold text-slate-300">+{stats.elevationM} m</span>
                         </div>
                         <div className="flex items-center gap-1.5">
                            <IconZap size={12} className="text-orange-500" />
                            <span className="text-[10px] font-bold text-slate-300">{stats.calories} kcal</span>
                         </div>
                      </div>
                    </button>
                  );
                })}
                <button onClick={() => { setSession({...DEFAULT_SESSIONS[0], name: 'PERSONALIZADA', id: Date.now(), segments: [{ id: 'custom-1', duration: 300, speed: 5, incline: 0 }] }); setView('SETUP'); start(); }} className="mt-4 border-2 border-dashed border-slate-700 p-6 rounded-3xl flex items-center justify-center gap-3 text-slate-500 hover:text-emerald-500 hover:border-emerald-500/50 transition-all active:scale-95">
                  <IconPlus /> <span className="font-bold">NUEVA SESIÓN</span>
                </button>
              </div>
            </div>
          )}

          {view === 'SETUP' && session && <WorkoutSetup session={session} onBack={() => setView('HOME')} onStart={s => { setSession(s); setView('ACTIVE'); }} />}
          {view === 'ACTIVE' && session && <WorkoutRunner session={session} onCancel={() => setView('HOME')} onFinish={() => setView('SUMMARY')} />}

          {view === 'SUMMARY' && (
            <div className="fixed inset-0 bg-slate-900 z-[100] flex items-center justify-center p-8 text-center pb-safe pt-safe">
              <div className="max-w-sm w-full">
                <div className="w-24 h-24 bg-emerald-500 text-slate-900 rounded-full flex items-center justify-center mx-auto mb-8 shadow-[0_0_50px_rgba(16,185,129,0.3)]"><IconActivity size={48} /></div>
                <h2 className="text-3xl font-black mb-4 uppercase tracking-tighter text-white">¡LOGRADO!</h2>
                <p className="text-slate-400 mb-8">Entrenamiento completado satisfactoriamente.</p>
                
                <div className="grid grid-cols-2 gap-4 mb-10">
                   <div className="bg-slate-800 p-4 rounded-2xl border border-slate-700">
                      <span className="text-[8px] text-slate-500 font-bold block uppercase mb-1">Calorías</span>
                      <span className="text-lg font-black text-white">{calculateSessionStats(session.segments).calories}</span>
                   </div>
                   <div className="bg-slate-800 p-4 rounded-2xl border border-slate-700">
                      <span className="text-[8px] text-slate-500 font-bold block uppercase mb-1">Tiempo</span>
                      <span className="text-lg font-black text-white">{calculateSessionStats(session.segments).formattedDuration}</span>
                   </div>
                   <div className="bg-slate-800 p-4 rounded-2xl border border-slate-700">
                      <span className="text-[8px] text-slate-500 font-bold block uppercase mb-1">Distancia</span>
                      <span className="text-lg font-black text-white">{calculateSessionStats(session.segments).distanceKm}km</span>
                   </div>
                   <div className="bg-slate-800 p-4 rounded-2xl border border-slate-700">
                      <span className="text-[8px] text-slate-500 font-bold block uppercase mb-1">Desnivel</span>
                      <span className="text-lg font-black text-white">+{calculateSessionStats(session.segments).elevationM}m</span>
                   </div>
                </div>

                <button onClick={() => setView('HOME')} className="w-full bg-white text-slate-900 py-5 rounded-2xl font-black text-xl shadow-xl active:scale-95 transition-transform">VOLVER AL INICIO</button>
              </div>
            </div>
          )}
        </div>
      );
    };

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
